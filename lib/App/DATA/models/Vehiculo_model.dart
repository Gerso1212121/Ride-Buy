import 'package:ezride/App/DOMAIN/Entities/vehicle_entity.dart';
import 'package:ezride/Core/enums/enums.dart';

class VehicleModel extends VehicleEntity {
  VehicleModel({
    required String id,
    required String empresaId,
    required String titulo,
    required String marca,
    required String modelo,
    int? anio,
    required String placa,
    required double precioPorDia,
    VehicleStatus status = VehicleStatus.disponible,
    int capacidad = 5,
    String transmision = 'automatica',
    String combustible = 'gasolina',
    int? kilometraje,
    String? color,
    int puertas = 4,
    String? duenoActual,
    String? soaNumber,
    DateTime? circulacionVence,
    DateTime? soaVence,
    bool multasPendientes = false,
    String? gpsDeviceId,
    String? insuranceProvider,
    bool telemetriaEnabled = false,
    String? telemetriaTrackerId,
    required DateTime createdAt,
    required DateTime updatedAt,
    String? imagen1,
    String? imagen2,
  }) : super(
          id: id,
          empresaId: empresaId,
          titulo: titulo,
          marca: marca,
          modelo: modelo,
          anio: anio,
          placa: placa,
          precioPorDia: precioPorDia,
          status: status,
          capacidad: capacidad,
          transmision: transmision,
          combustible: combustible,
          kilometraje: kilometraje,
          color: color,
          puertas: puertas,
          duenoActual: duenoActual,
          soaNumber: soaNumber,
          circulacionVence: circulacionVence,
          soaVence: soaVence,
          multasPendientes: multasPendientes,
          gpsDeviceId: gpsDeviceId,
          insuranceProvider: insuranceProvider,
          telemetriaEnabled: telemetriaEnabled,
          telemetriaTrackerId: telemetriaTrackerId,
          createdAt: createdAt,
          updatedAt: updatedAt,
          imagen1: imagen1,
          imagen2: imagen2,
        );

  factory VehicleModel.fromMap(Map<String, dynamic> map) {
    return VehicleModel(
      id: map['id'] as String,
      empresaId: map['empresa_id'] as String,
      titulo: map['titulo'] as String,
      marca: map['marca'] as String,
      modelo: map['modelo'] as String,
      anio: map['anio'] as int?,
      placa: map['placa'] as String,
      precioPorDia: (map['precio_por_dia'] as num).toDouble(),
      status: VehicleStatus.values.firstWhere(
        (e) => e.name == map['status'],
        orElse: () => VehicleStatus.disponible,
      ),
      capacidad: map['capacidad'] as int? ?? 5,
      transmision: map['transmision'] as String? ?? 'automatica',
      combustible: map['combustible'] as String? ?? 'gasolina',
      kilometraje: map['kilometraje'] as int?,
      color: map['color'] as String?,
      puertas: map['puertas'] as int? ?? 4,
      duenoActual: map['dueno_actual'] as String?,
      soaNumber: map['soa_number'] as String?,
      circulacionVence: map['circulacion_vence'] != null
          ? DateTime.parse(map['circulacion_vence'] as String)
          : null,
      soaVence: map['soa_vence'] != null
          ? DateTime.parse(map['soa_vence'] as String)
          : null,
      multasPendientes: map['multas_pendientes'] as bool? ?? false,
      gpsDeviceId: map['gps_device_id'] as String?,
      insuranceProvider: map['insurance_provider'] as String?,
      telemetriaEnabled: map['telemetria_enabled'] as bool? ?? false,
      telemetriaTrackerId: map['telemetria_tracker_id'] as String?,
      createdAt: DateTime.parse(map['created_at'] as String),
      updatedAt: DateTime.parse(map['updated_at'] as String),
      imagen1: map['imagen1'] as String?,
      imagen2: map['imagen2'] as String?,
    );
  }

  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'empresa_id': empresaId,
      'titulo': titulo,
      'marca': marca,
      'modelo': modelo,
      'anio': anio,
      'placa': placa,
      'precio_por_dia': precioPorDia,
      'status': status.name,
      'capacidad': capacidad,
      'transmision': transmision,
      'combustible': combustible,
      'kilometraje': kilometraje,
      'color': color,
      'puertas': puertas,
      'dueno_actual': duenoActual,
      'soa_number': soaNumber,
      'circulacion_vence': circulacionVence?.toIso8601String(),
      'soa_vence': soaVence?.toIso8601String(),
      'multas_pendientes': multasPendientes,
      'gps_device_id': gpsDeviceId,
      'insurance_provider': insuranceProvider,
      'telemetria_enabled': telemetriaEnabled,
      'telemetria_tracker_id': telemetriaTrackerId,
      'created_at': createdAt.toIso8601String(),
      'updated_at': updatedAt.toIso8601String(),
      'imagen1': imagen1,
      'imagen2': imagen2,
    };
  }
}
